<!DOCTYPE html>
<html>
<head>
    <title>Expenses</title>
</head>
<body>
    <h1>Uploaded Expenses</h1>
    <form method="get" action="">
    <input type="text" name="q" value="{{ query }}" placeholder="Search by title, amount, date, or notes" />

    <select name="sort">
        <option value="">Sort By</option>
        <option value="title_asc" {% if sort == 'title_asc' %}selected{% endif %}>Title A-Z</option>
        <option value="title_desc" {% if sort == 'title_desc' %}selected{% endif %}>Title Z-A</option>
        <option value="amount_asc" {% if sort == 'amount_asc' %}selected{% endif %}>Amount Low to High</option>
        <option value="amount_desc" {% if sort == 'amount_desc' %}selected{% endif %}>Amount High to Low</option>
        <option value="date_asc" {% if sort == 'date_asc' %}selected{% endif %}>Date Oldest</option>
        <option value="date_desc" {% if sort == 'date_desc' %}selected{% endif %}>Date Newest</option>
    </select>

    <button type="submit">Apply</button>
    </form>

    <table border="1">
    <tr>
        <th>Title</th>
        <th>Amount</th>
        <th>Date</th>
        <th>Receipt</th>
        <th>Notes</th>
    </tr>
    {% for expense in expenses %}
    <tr>
        <td>{{ expense.title }}</td>
        <td>{{ expense.amount }}</td>
        <td>{{ expense.date|date:"M. j, Y" }}</td>
        <td>
            {% if expense.receipt %}
                <a href="{{ expense.receipt.url }}" target="_blank">
                    <img src="{{ expense.receipt.url }}" alt="Receipt" width="100" />
                </a>
            {% else %}
                No Receipt
            {% endif %}
        </td>
        <td>{{ expense.notes|truncatewords:20 }}</td>
    </tr>
    {% endfor %}
</table>

    <a href="{% url 'upload_expense' %}">Upload Another Expense</a>
</body>
</html>
